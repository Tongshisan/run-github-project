# 更新日志 - 智能过滤功能

## v2.0.0 - 2025-12-27

### 🆕 新功能

#### 智能过滤系统
- **问题**：GitHub Search API 只能按关键词搜索，结果常常"牛头不对马嘴"
  - 例如：搜"毕业设计的前端项目"会搜到不相关的结果
  - 纯粹按 stars 排序，不考虑用户真实需求
  
- **解决方案**：LLM + README 内容分析
  1. 用 GitHub API 获取初步结果（30个）
  2. 读取每个项目的 README 内容
  3. LLM 根据用户原始需求评分（0-100）
  4. 按相关性排序，返回最匹配的 10 个

- **使用方法**：
  ```bash
  # 启用智能过滤
  python agent.py --llm --smart-filter --query "找适合毕业设计的前端项目"
  ```

- **效果对比**：
  - **之前**：搜索 "graduation frontend" → 0 个结果（关键词太怪）
  - **现在**：搜索 "frontend starter" → 30 个结果 → LLM 筛选 → 10 个最相关的

#### 新增模块
- `smart_filter.py` - 智能过滤核心逻辑
  - `SmartFilter.fetch_readme()` - 获取 README 内容
  - `SmartFilter.score_repo()` - LLM 评分
  - `SmartFilter.filter_and_rank()` - 过滤和排序

#### AI 评分展示
- 搜索结果现在会显示：
  ```
  [1] vue-element-admin
  ⭐ Stars: 87,000 | 🍴 Forks: 30,000
  🧠 AI评分: 95/100 | 💡 完整的后台管理系统，功能丰富，适合毕业设计
  ```

### 🔧 改进

#### 提示词优化
- **问题**：关键词太多导致搜不到结果
  - 之前："3d website interactive animation webgl" → 0 个结果
  - 原因：GitHub 搜索是 AND 逻辑，5 个词都要匹配

- **解决方案**：限制关键词数量
  - 现在：最多 2-3 个核心关键词
  - "webgl 3d" → 1,001 个结果 ✅
  
- **提示词改进**：
  - 明确告诉 LLM"最多 2-3 个关键词"
  - 添加更多示例和反例
  - 强调"宁可少不要多"

#### 搜索流程优化
- 智能过滤模式下：
  - 获取 3x 数量的初步结果
  - LLM 评分后筛选出最相关的
  - 例如：用户要 10 个 → 先搜 30 个 → LLM 评分 → 返回最好的 10 个

### 📖 文档

- 新增 `SMART_FILTER.md` - 智能过滤功能详细说明
- 新增 `test_smart_filter.sh` - 快速测试脚本

### ⚙️ 技术细节

#### 依赖
- 已有依赖：`requests`, `openai` (或其他 LLM 库)
- 无需额外安装

#### API 调用
- GitHub Contents API: `GET /repos/{owner}/{repo}/contents/README.md`
- LLM API: 每个项目评分需要 1 次调用
- 成本估算（DeepSeek）：
  - 10 个结果 → 30 次评分 → ~0.01 CNY
  - 100 个结果 → 300 次评分 → ~0.1 CNY

#### 性能
- 基础搜索：1-2 秒
- 智能过滤（10 个结果）：10-30 秒
  - README 读取：~0.5秒/个
  - LLM 评分：~0.5秒/个

### 🎯 使用场景

#### 适合用智能过滤：
✅ "找适合毕业设计的前端项目"
✅ "包含支付功能的电商项目"
✅ "适合学习的 Vue 项目"
✅ "好看的 3D 网站示例"

#### 不需要智能过滤：
❌ "React UI 库"（技术栈明确，按 stars 排序即可）
❌ "Python 爬虫框架"（同上）

### 🐛 已知问题

1. **README 读取可能失败**
   - 某些项目没有 README
   - 某些 README 文件名不标准
   - 解决：尝试多个常见文件名

2. **LLM 评分速度较慢**
   - 串行评分，30 个项目需要 15-30 秒
   - 计划：未来支持并行评分

3. **GitHub API 限制**
   - 未认证：60 次/小时
   - 已认证：5000 次/小时
   - 建议：设置 GitHub Token

### 🔮 未来计划

- [ ] **并行评分**：提升速度 3-5 倍
- [ ] **README 缓存**：避免重复请求
- [ ] **GitHub MCP 集成**：直接使用 Cursor 的 MCP 工具
- [ ] **自定义评分标准**：让用户定义评分权重
- [ ] **更多过滤条件**：
  - 最近更新时间
  - 维护状态（活跃 / 已废弃）
  - Issue/PR 数量
  - 文档完善程度

### 🙏 致谢

感谢用户反馈"搜索牛头不对马嘴"的问题，促成了这次重大更新！

---

## 使用示例

### 测试优化后的提示词

```bash
# 之前会搜到 0 个结果
python agent.py --llm --query "找炫酷的 3D 网站"

# 现在会搜到很多结果
# LLM 会提取：["webgl", "3d"] 而不是 5 个关键词
```

### 测试智能过滤

```bash
# 运行测试脚本
./test_smart_filter.sh

# 或手动测试
python agent.py --llm --smart-filter --query "找适合毕业设计的前端项目"
```

预期结果：
- ✅ 搜索到 30 个候选项目
- ✅ 读取每个项目的 README
- ✅ LLM 根据"适合毕业设计"评分
- ✅ 返回最相关的 10 个，附带推荐理由

---

**版本**: v2.0.0  
**日期**: 2025-12-27  
**作者**: GitHub Agent Team

